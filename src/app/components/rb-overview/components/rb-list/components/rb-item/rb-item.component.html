<div [class.small-details]="!showDetails()" class="flex flex-col sm:flex-row sm:items-center p-6 gap-4">
    @if(showDetails()) {
    <div class="md:w-40 relative">
        <img class="rb-img block xl:block mx-auto rounded-border" [src]="rb()?.meta?.imageUrl" />
    </div>
    }
    <div class="content-wrapper flex flex-col md:flex-row justify-between md:items-center flex-1 gap-6">
        <div class="rb-content flex flex-col gap-3 w-full">
            <div class="title-wrapper">
                <div class="text-lg font-medium text-surface-900 dark:text-surface-0">
                    @if(!showDetails()) {
                    <p-tag [value]="status()" [severity]="tagSeverity()" class="dark:!bg-surface-900" />
                    }
                    <span class="rb-lvl">[{{rb().lvl}}] </span>
                    <span class="rb-name">{{ rb()?.displayName }}</span>
                    @if(showDetails()) {
                    <p-tag [value]="status()" [severity]="tagSeverity()" class="dark:!bg-surface-900" />
                    }
                </div>
            </div>

            <div class="time-info flex flex-col sm:flex-row sm:items-end gap-3 w-full">
                <div class="w-full sm:w-56">
                    <label class="block font-bold mb-2" for="dead-time">Время убийства</label>
                    <div class="flex items-center gap-2">
                        <p-datepicker inputId="dead-time" class="date-input flex-1 w-full" [(ngModel)]="deadTime"
                            (ngModelChange)="onDeadTimeDraftChange($event)" [showTime]="true" [hourFormat]="'24'" />

                        <p-button *ngIf="hasDeadTimeChanges()" icon="pi pi-check" [text]="true" [severity]="'success'"
                            ariaLabel="Save" (onClick)="commitDeadTime()"></p-button>
                    </div>
                </div>

                <div class="w-full grid grid-cols-1 md:grid-cols-3 gap-3">
                    @if(showDetails()) {
                    <div>
                        <label class="block font-bold mb-2">Мин. респ</label>
                        <div class="border border-surface rounded bg-emphasis text-muted-color text-sm px-3 py-2">
                            {{ displayMinResp() ? (displayMinResp() | date : 'HH:mm' : 'Europe/Kyiv') : '—' }}
                        </div>
                    </div>
                    <div>
                        <label class="block font-bold mb-2">Макс. респ</label>
                        <div class="border border-surface rounded bg-emphasis text-muted-color text-sm px-3 py-2">
                            {{ displayMaxResp() ? (displayMaxResp() | date : 'HH:mm' : 'Europe/Kyiv') : '—' }}
                        </div>
                    </div>
                    }
                    <div>
                        <label class="block font-bold mb-2">{{ timeLeftLabel() }}</label>
                        <div class="border border-surface rounded bg-emphasis text-muted-color text-sm px-3 py-2">
                            {{ timeLeftLabel() ? (respElapsedLabel() != null ? respElapsedLabel() : (timeLeft() ?
                            (timeLeft() | date : 'HH:mm:ss') : '—')) : '' }}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="actions flex flex-col md:items-end gap-8">
            <div class="actions flex md:flex-row gap-2">
                <p-button
                    icon="pi pi-info-circle"
                    [text]="true"
                    [severity]="'secondary'"
                    ariaLabel="Info"
                    (onClick)="lootPanel.toggle($event)"
                ></p-button>

                <p-button icon="pi pi-refresh" class="flex-auto md:flex-initial whitespace-nowrap" label="Обновить респ"
                    (onClick)="setKillTimeNowKyiv()"></p-button>
            </div>
        </div>
    </div>
</div>

<p-popover #lootPanel>
    <div class="flex flex-col gap-3 min-w-64">
        <div class="text-sm font-medium text-surface-900 dark:text-surface-0">Лут</div>

        @if ((rb()?.loot?.length ?? 0) > 0) {
            <div class="flex flex-col gap-2">
                @for (loot of (rb()?.loot ?? []); track $index) {
                    <div class="flex items-center gap-2">
                        <img
                            class="w-8 h-8 rounded border border-surface bg-surface-0 dark:bg-surface-900 object-contain"
                            [src]="loot?.imgUrl"
                            [alt]="loot?.displayName"
                        />
                        <div class="text-sm text-surface-900 dark:text-surface-0">{{ loot?.displayName }}</div>
                    </div>
                }
            </div>
        } @else {
            <div class="text-sm text-muted-color">Нет лута</div>
        }

        <div class="pt-2 border-t border-surface flex justify-end">
            <p-button
                label="Подробнее"
                [text]="true"
                [severity]="'secondary'"
                [disabled]="!rb()?.meta?.infoLink"
                (onClick)="openInfoLink()"
            ></p-button>
        </div>
    </div>
</p-popover>